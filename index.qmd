---
title: "Project title"
subtitle: "STA/ISS 313 - Project 1"
author: "Visualization Warriors"
format: html
editor: visual
---

## Abstract

(1 paragraph): Project abstract.

## Introduction

The `pell` data set was featured on TidyTuesday in 2022. It contains information on the distribution of pell grant awards to college students in the United States from 1999-2017. This data set is a compilation of yearly datasets collected by the US Department of Education. The original yearly data was reported by the USDE in different ways across the years, after which it was cleaned up to become the \`pell\` data set that will be used in this project. 

The `pell` data set contains 100470 cases of Pell grant awards and contains 4 missing values. It explores the award amount in each school for each respective year represented in the data set. The variables in this data set include the state in which the school's located, the total Pell grant award the school gave, the number of students at the school who received a Pell grant, the name of the school, the session year, and the year. Specifically, the variables `NAME`, `FACTOR`, and `SESSION` are all factor variables while the other variables are numeric. There are some important notes to keep in mind when interpreting the data set. Firstly, the variable `STATE` includes both US states and territories, meaning there are more than 50 possible observation types. Finally, the difference between `SESSION` and `YEAR` is that `SESSION` indicates the academic school year (which is between two numeric years)

\

## Question 1: Need title.

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

In order to understand how Pell grant awards change over time based on the geographic region, we created two visualizations that rely on the mutation of two additional variables which are `average_pell_grant` per school and `region`.
 
The first visualization is a spatial graph showcasing the average pell grant award across presidencies. It displays 6 maps of the United States (one for each presidential term) with each state colored based upon the average pell grant award in that state for the respective presidential term. This is the best way to visualize this information. In order to compare all 50 states at once, the only visually appealing way that is not overcrowded is a map. Showcasing 6 different maps to display change over time allows for simple comparison without overcrowding.

Our second visualization is a line graph which explores the time series progression of pell grant awards by region. Time (by year) will be on the x-axis and `average pell grant` award is on the y-axis, faceted by region. A line graph best represents the information we are seeking to understand in our research question because it provides a clear, year-to-year representation of pell grant awards for each region and allows us to visually observe the changes for each region of the United States. We chose to make the line breaks on the x-axis the year of presidential elections as we hypothesized that these years would have the most dramatic differences.


### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions

```{r load-packages}
library(ggplot2)
library(tidyverse)
library(wesanderson)
require(maps)
require(viridis)
theme_set(
  theme_void()
)
```

```{r data-adjustment}
#load the region data set + join to original (be sure to account for the territories)

pell <- read_csv("data/pell.csv")
regions <- read_csv("data/region.csv")
enrollment <- read_csv("data/College_Enrollment_Data.csv")

pell <- pell |>
  drop_na(AWARD)

pell <- pell |>
  mutate(TERM = case_when(
    YEAR %in% c(1999, 2000) ~ 'Clinton (1999-2000)',
     YEAR %in% c(2001, 2002, 2003, 2004) ~ 'Bush (2001-2004)',
     YEAR %in% c(2005, 2006, 2007, 2008) ~ 'Bush (2005-2008)',
     YEAR %in% c(2009, 2010, 2011, 2012) ~ 'Obama (2009-2012)',
     YEAR %in% c(2013, 2014, 2015, 2016) ~ 'Obama (2013-2016)',
     YEAR %in% c(2017) ~ 'Trump (2017-2018)'
  ), 
  TERM = fct_relevel(TERM,
                     "Clinton (1999-2000)", "Bush (2001-2004)",
                     "Bush (2005-2008)", "Obama (2009-2012)",
                     "Obama (2013-2016)", "Trump (2017-2018)"
                     )
  )

pell_grouped <- pell |>
  group_by(STATE, TERM) %>%
  summarise(
    total_award = sum(AWARD),
    total_recipients = sum(RECIPIENT)
    ) %>%
  mutate(AVG_PELL_AWARD = total_award/total_recipients)

map_state <- map_data("state")
map_state$region <- str_to_title(map_state$region)
map_state$STATE <- state.abb[match(map_state$region, state.name)]
pell_map <- left_join(map_state, pell_grouped, by = "STATE")

pell_map <- pell_map |>
  drop_na(TERM)

```

```{r create q1-plot1}
ggplot(pell_map, aes(long, lat, group = group)) + 
  geom_polygon(aes(fill = AVG_PELL_AWARD), color = "white") + 
  facet_wrap(~TERM) +
  labs(fill = "Average Award ($)",
       title = "Consistent State-by-State Upward Trend Across Presidencies")

```

```{r}
pell2 <- left_join(pell, regions, by = "STATE") #decided to drop all territories

#began creating the avg_pell_award data

pell2 <- pell2 |>
  drop_na(REGION)

pell_grouped2 <- pell2 |>
  group_by(REGION, YEAR) %>%
  summarise(
    total_award = sum(AWARD),
    total_recipients = sum(RECIPIENT)
    ) %>%
  mutate(AVG_PELL_AWARD = total_award/total_recipients)
```

``` {visualization-1-time}
```

```{r create q1-plot2}
ggplot(pell_grouped2, aes(x = YEAR, y = AVG_PELL_AWARD,
                          group = REGION, color = REGION)) + 
  geom_line() +
  theme_minimal() +
  scale_color_manual(values = wes_palette("Moonrise2", n = 4)) + 
  scale_x_continuous(breaks = seq(from = 2000, to = 2018, by = 4)) +
  labs(title = "Upward Trend in Average Pell Grant", 
       subtitle = "Grouped by Region", 
       x = "Year", 
       y = "Average Pell Award ($)")
```

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.

## Question 2: Title that relates to the question you're answering

```{r}
enrollment <- enrollment[1:51,] |>
  mutate(STATE = c("AL", "AK", "AZ", "AR", "CA", "CO", "CT", "DE", "DC", "FL", "GA",
           "HI", "ID", "IL", "IN", "IA", "KS", "KY", "LA", "ME", "MD", "MA",
           "MI", "MN", "MS", "MO", "MT", "NE", "NV", "NH", "NJ", "NM", "NY",
           "NC", "ND", "OH", "OK", "OR", "PA", "RI", "SC", "SD", "TN", "TX",
           "UT", "VT", "VA", "WA", "WV", "WI", "WY")) |>
  select(c("Enrollment_2020", "STATE", "percent_change_from_2010"))

enrollment <- enrollment[, c(2,1,3)]

enrollment <- enrollment |>
  mutate(percent_change_from_2010 = as.numeric(gsub("\\%", "", percent_change_from_2010)),
            Enrollment_2010 = (Enrollment_2020 / (1+(percent_change_from_2010/100))))


enrollment_pell <- inner_join(enrollment, pell, by = "STATE")

enrollment_pell <- enrollment_pell |>
  mutate(Enrollment_2011 = Enrollment_2010 * (1+(percent_change_from_2010/1000)),
         Enrollment_2012 = Enrollment_2010 * (1+(2*percent_change_from_2010/1000)),
         Enrollment_2013 = Enrollment_2010 * (1+(3*percent_change_from_2010/1000)),
         Enrollment_2014 = Enrollment_2010 * (1+(4*percent_change_from_2010/1000)),
         Enrollment_2015 = Enrollment_2010 * (1+(5*percent_change_from_2010/1000)),
         Enrollment_2016 = Enrollment_2010 * (1+(6*percent_change_from_2010/1000)),
         Enrollment_2017 = Enrollment_2010 * (1+(7*percent_change_from_2010/1000)),
         Enrollment_2018 = Enrollment_2010 * (1+(8*percent_change_from_2010/1000)),
         Enrollment_2019 = Enrollment_2010 * (1+(9*percent_change_from_2010/1000)))


mutate(Enrollment_2010 = (Enrollment_2020 / (1-(percent_change_from_2010/100)))


```

```{r}
enrollment_pell_grouped_2010 <- enrollment_pell |>
  filter(YEAR == 2010) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2010 = sum(RECIPIENT) / sum(Enrollment_2010))


enrollment_pell_grouped_2011 <- enrollment_pell |>
  filter(YEAR == 2011) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2011 = sum(RECIPIENT) / sum(Enrollment_2011))


enrollment_pell_grouped_2012 <- enrollment_pell |>
  filter(YEAR == 2012) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2012 = sum(RECIPIENT) / sum(Enrollment_2012))

enrollment_pell_grouped_2013 <- enrollment_pell |>
  filter(YEAR == 2013) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2013 = sum(RECIPIENT) / sum(Enrollment_2012))


enrollment_pell_grouped_2014 <- enrollment_pell |>
  filter(YEAR == 2014) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2014 = sum(RECIPIENT) / sum(Enrollment_2014))

enrollment_pell_grouped_2015 <- enrollment_pell |>
  filter(YEAR == 2015) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2015 = sum(RECIPIENT) / sum(Enrollment_2015))


enrollment_pell_grouped_2016 <- enrollment_pell |>
  filter(YEAR == 2016) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2016 = sum(RECIPIENT) / sum(Enrollment_2016))


enrollment_pell_grouped_2017 <- enrollment_pell |>
  filter(YEAR == 2017) |>
  group_by(STATE) |>
  summarise(
    prop_receiving_pell_2017 = sum(RECIPIENT) / sum(Enrollment_2017))


list_dfs = list(enrollment_pell_grouped_2010, enrollment_pell_grouped_2011, enrollment_pell_grouped_2012, enrollment_pell_grouped_2013,
                                          enrollment_pell_grouped_2014, enrollment_pell_grouped_2015, enrollment_pell_grouped_2016, enrollment_pell_grouped_2017)

enrollment_pell_grouped_all <- list_dfs %>% reduce(left_join, by='STATE')

enrollment_longer <- enrollment_pell_grouped_all |>
  pivot_longer(cols = contains("20")) |>
  mutate(year = str_sub(name, start= -4),
         proportion_receiving_pell = value) |>
  select(1,4,5)

enrollment_longer


enrollment_longer |>
  group_by(STATE) |>
  summarize(mean_prop = mean(proportion_receiving_pell))


#AK, RI, WY, DC, DE


high_enroll <- enrollment_longer |>
  filter(STATE %in% (c("AK", "RI", "WY", "DC", "DE")))

```

```{r}

enrollment_longer |>
  ggplot(aes(
    x = year,
    y = proportion_receiving_pell)) +
  geom_line(aes(group = STATE), alpha = .3, color = "grey") + 
  geom_line(data = high_enroll, 
            aes(x = year,
                y = proportion_receiving_pell, group = STATE, color = STATE), 
             size = 2) +
  theme_minimal() + 
  scale_color_viridis_d() +
  labs(title = "Proportion of Students Receiving a Pell Grant in Each State",
       subtitle = "Highlighting the States with the Highest Proportion of Pell Grants",
       x = "Year",
       y = "Proportion of Students Receiving a Pell Grant",
       caption = "Amount of students enrolled is Interpolated from 2010 and 
       2020 data"
       ) 

```


```{r}

```

### Introduction

(1-2 paragraphs): Introduction to the question and what parts of the dataset are necessary to answer the question. Also discuss why you're interested in this question.

### Approach

(1-2 paragraphs): Describe what types of plots you are going to make to address your question. For each plot, provide a clear explanation as to why this plot (e.g. boxplot, barplot, histogram, etc.) is best for providing the information you are asking about. The two plots should be of different types, and at least one of the two plots needs to use either color mapping or facets.

From the raw data set, we will use the state in which the school is located, the total amount of Pell grant recipients for each year, and the year. We will summarize the data to just get the amount of Pell recipients by state by year. From there, we will incorporate enrollment data for the total amount of students enrolled in university by state by year. With that data, we will be able to calculate the proportion of students who are enrolled in university receiving a Pell Grant by dividing amount of recipients by state by year by total undergrads enrolled by state by year.

For our first visualization, we plan to use a line graph to visualize the proportion of students receiving a pell grant over time in each state. We will do this by having a line for each of the 50 states and having a very low alpha value for most of them, with a few that we want to highlight having a higher alpha level. This will allow us to clearly show a few notable stats over the top of the general trend for all of the states. For our second visualization, we plan to get the coordinates for each college by using a google maps API and then plotting a dot at each college. The dot will be sized based on the amount of pell grant recipients at the school and colored by the proportion of students receiving a pell grant. We then will put a few of these maps side by side each representing a different time period, possibly corresponding to presidential cycle. This will allow us to see trends in states and areas in both amounts of students and proportions.

### Analysis

(2-3 code blocks, 2 figures, text/code comments as needed): In this section, provide the code that generates your plots. Use scale functions to provide nice axis labels and guides. You are welcome to use theme functions to customize the appearance of your plot, but you are not required to do so. All plots must be made with **ggplot2**. Do not use base R or lattice plotting functions.

### Discussion

(1-3 paragraphs): In the Discussion section, interpret the results of your analysis. Identify any trends revealed (or not revealed) by the plots. Speculate about why the data looks the way it does.
